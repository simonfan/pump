//     pump
//     (c) simonfan
//     pump is licensed under the MIT terms.

define("__pump/pipe",["require","exports","module","lodash"],function(i,e){var t=i("lodash");e.addPipe=function(){var i,e,s;t.isString(arguments[0])?(i=arguments[0],e=arguments[1],s=arguments[2]||{}):(i=t.uniqueId("pipe"),e=arguments[0],s=arguments[1]||{}),s.source=this.source;var r=this._buildPipe(e,s);return this.pipes[i]=r,r},e.pipe=e.addPipe,e.removePipe=function(i,e){return t.isFunction(i)?t.each(this.pipes,function(t,s){i.call(e,t,s)&&delete this.pipes[s]},this):t.isArray(i)?t.each(i,function(e,s){t.contains(i,s)&&delete this.pipes[s]},this):delete this.pipes[i],this},e.unpipe=e.removePipe}),define("__pump/streams",["require","exports","module","lodash","q"],function(i,e){function t(i,e){var t;e?(e=s.isArray(e)?e:[e],t=s.pick(this.pipes,e)):t=this.pipes;var p=s.map(t,function(e){return e[i]()});return r.all(p)}var s=i("lodash"),r=i("q");e.pump=s.partial(t,"pump"),e.drain=s.partial(t,"drain"),e.inject=function(i,e){var t=this.srcSet||this.set;if(!this.source)throw new Error("No source for pump");var p=s.map(i,function(i,e){return t.call(this,this.source,e,i)},this);return r.all(p).then(s.bind(function(){this.pump(e)},this)).fail(function(i){throw i})}}),define("pump",["require","exports","module","subject","lodash","pipe","./__pump/pipe","./__pump/streams"],function(i,e,t){var s=i("subject"),r=i("lodash"),p=i("pipe"),n=["srcGet","srcSet","destGet","destSet"],u=t.exports=s({initialize:function(i,e){this.source=i,this._buildPipe=p.extend(r.pick(this,n)),this.pipes={},r.each(e,function(i,e){this.pipe(e,i)},this)},from:function(i){return this.source=i,r.each(this.pipes,function(e){e.from(i)}),this},get:function(i,e){return i[e]},set:function(i,e,t){return i[e]=t,this}});u.assignProto(i("./__pump/pipe")).assignProto(i("./__pump/streams"))});