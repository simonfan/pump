//     pump
//     (c) simonfan
//     pump is licensed under the MIT terms.

define("__pump/pipe",["require","exports","module","lodash"],function(e,i){var t=e("lodash");i.addPipe=function(){var e,i,s;t.isString(arguments[0])?(e=arguments[0],i=arguments[1],s=arguments[2]||{}):(e=t.uniqueId("pipe"),i=arguments[0],s=arguments[1]||{}),s.source=this.source;var p=this._buildPipe(i,s);return this.pipes[e]=p,p},i.pipe=i.addPipe,i.removePipe=function(e,i){return t.isFunction(e)?t.each(this.pipes,function(t,s){e.call(i,t,s)&&delete this.pipes[s]},this):t.isArray(e)?t.each(e,function(i,s){t.contains(e,s)&&delete this.pipes[s]},this):delete this.pipes[e],this},i.unpipe=i.removePipe}),define("__pump/streams",["require","exports","module","lodash","q"],function(e,i){function t(e,i){var t;i?(i=s.isArray(i)?i:[i],t=s.pick(this.pipes,i)):t=this.pipes;var r=s.map(t,function(i){return i[e]()});return p.all(r)}var s=e("lodash"),p=e("q");i.pump=s.partial(t,"pump"),i.drain=s.partial(t,"drain"),i.inject=function(e,i){var t=this.srcSet||this.set;if(!this.source)throw new Error("No source for pump");var r=s.map(e,function(e,i){return t.call(this,this.source,i,e)},this);return p.all(r).then(s.bind(function(){this.pump(i)},this)).fail(function(e){throw e})}}),define("pump",["require","exports","module","subject","lodash","pipe","./__pump/pipe","./__pump/streams"],function(e,i,t){var s=e("subject"),p=e("lodash"),r=e("pipe"),n=["srcGet","srcSet","destGet","destSet"],u=t.exports=s({initialize:function(e,i){this.source=e,this._buildPipe=r.extend(p.pick(this,n)),this.pipes={},p.each(i,function(e,i){this.pipe(i,e)},this)}});u.assignProto(e("./__pump/pipe")).assignProto(e("./__pump/streams"))});