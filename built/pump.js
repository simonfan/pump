//     pump
//     (c) simonfan
//     pump is licensed under the MIT terms.

define("__pump/pipe",["require","exports","module","lodash"],function(i,e){var t=i("lodash");e.addPipe=function(){var i,e,s;t.isString(arguments[0])?(i=arguments[0],e=arguments[1],s=arguments[2]||{}):(i=t.uniqueId("pipe"),e=arguments[0],s=arguments[1]||{}),s.source=this.source;var n=this._buildPipe(e,s);return 0===t.size(this.pipes)&&this.setDrainingPipe(i),this.pipes[i]=n,n},e.pipe=e.addPipe,e.removePipe=function(i,e){return t.isFunction(i)?t.each(this.pipes,function(t,s){i.call(e,t,s)&&delete this.pipes[s]},this):t.isArray(i)?t.each(i,function(e,s){t.contains(i,s)&&delete this.pipes[s]},this):delete this.pipes[i],this},e.unpipe=e.removePipe}),define("__pump/streams/pump",["require","exports","module","lodash","q"],function(i,e){var t=i("lodash"),s=i("q");e.pump=function(i,e,n){var r;i?(i=t.isArray(i)?i:[i],r=t.pick(this.pipes,i)):r=this.pipes;var p=t.map(r,function(i){return i.pump(e,n)});return s.all(p)}}),define("__pump/streams/drain",["require","exports","module","lodash","q"],function(i,e){function t(i){return s.isString(this.drainingPipe)?this.pipes[this.drainingPipe]:s.isFunction(this.drainingPipe)?this.drainingPipe(i):s.isObject(this.drainingPipe)?this.drainingPipe:void 0}{var s=i("lodash");i("q")}e.drainingPipe=void 0,e.drain=function(i,e,s){var n=this.pipes[i]||t.call(this,e);if(!n)throw new Error('Pipe "'+i+'" not found.');return n.drain(e,s)},e.setDrainingPipe=function(i){return this.drainingPipe=i,this}}),define("__pump/streams/inject",["require","exports","module","lodash","q"],function(i,e){var t=i("lodash"),s=i("q");e.inject=function(i,e){var n=this.srcSet||this.set;if(!this.source)throw new Error("No source for pump");var r=t.map(i,function(i,e){return n.call(this,this.source,e,i)},this);return s.all(r).then(t.bind(function(){this.pump(e)},this)).fail(function(i){throw i})}}),define("pump",["require","exports","module","subject","lodash","pipe","./__pump/pipe","./__pump/streams/pump","./__pump/streams/drain","./__pump/streams/inject"],function(i,e,t){var s=i("subject"),n=i("lodash"),r=i("pipe"),p=["srcGet","srcSet","destGet","destSet"],u=t.exports=s({initialize:function(i,e){this.source=i,this._buildPipe=r.extend(n.pick(this,p)),this.pipes={},n.each(e,function(i,e){this.pipe(e,i)},this)},from:function(i){return this.source=i,n.each(this.pipes,function(e){e.from(i)}),this},get:function(i,e){return i[e]},set:function(i,e,t){return i[e]=t,this}});u.assignProto(i("./__pump/pipe")).assignProto(i("./__pump/streams/pump")).assignProto(i("./__pump/streams/drain")).assignProto(i("./__pump/streams/inject"))});